# 线上图书系统 - 用例分析文档

## 📋 文档概述

**文档名称**：系统用例分析 (Use Case Analysis)  
**项目名称**：线上图书系统 (Online Bookstore System)  
**分析范围**：所有用户角色和系统功能  
**文档版本**：v1.0  
**最后更新**：2024年  

---

## 👥 系统角色定义

### 1. 访客 (Guest)
**角色描述**：未登录的系统访问者  
**权限级别**：最低  
**主要目标**：浏览图书信息，注册成为用户  

**可执行操作**：
- ✅ 浏览图书列表
- ✅ 搜索图书
- ✅ 按分类筛选图书
- ✅ 查看图书详情
- ✅ 查看图书评分和评论
- ✅ 注册账号
- ✅ 登录系统
- ❌ 加入购物车
- ❌ 提交订单
- ❌ 发表评论

### 2. 注册用户 (Registered User)
**角色描述**：已注册并登录的普通用户  
**权限级别**：中等  
**主要目标**：购买图书，管理订单  

**可执行操作**：
- ✅ 所有访客权限
- ✅ 加入购物车
- ✅ 管理购物车（增删改）
- ✅ 提交订单
- ✅ 查看订单列表
- ✅ 查看订单详情
- ✅ 取消订单
- ✅ 发表评论
- ✅ 评分图书
- ✅ 退出登录
- ❌ 管理图书
- ❌ 管理用户
- ❌ 查看销售统计

### 3. 管理员 (Administrator)
**角色描述**：系统管理员  
**权限级别**：最高  
**主要目标**：管理系统资源，维护系统运行  

**可执行操作**：
- ✅ 登录管理后台
- ✅ 管理图书（增删改查）
- ✅ 管理用户（增删改查）
- ✅ 管理订单（查看、更新状态、取消）
- ✅ 管理分类（增删改查）
- ✅ 查看销售统计
- ✅ 查看用户统计
- ✅ 查看热门图书
- ✅ 库存管理
- ✅ 查看操作日志
- ✅ 退出登录
- ❌ 在线上系统购物（需切换到用户角色）

---

## 📊 用例分类

### 用户认证用例 (Authentication Use Cases)

#### UC-001: 用户注册
**用例名称**：用户注册  
**参与者**：访客  
**前置条件**：访客访问注册页面  
**后置条件**：创建新用户账号，跳转到登录页面  

**主要流程**：
1. 访客点击"注册"按钮
2. 系统显示注册表单（含粒子背景特效）
3. 访客输入用户名、邮箱、密码
4. 系统验证数据格式
5. 系统检查用户名和邮箱是否重复
6. 系统创建新用户记录
7. 系统显示注册成功提示
8. 系统跳转到登录页面

**异常流程**：
- 4a. 数据格式不正确 → 显示错误提示，返回步骤3
- 5a. 用户名已存在 → 显示"用户名已被使用"，返回步骤3
- 5b. 邮箱已存在 → 显示"邮箱已被注册"，返回步骤3

**业务规则**：
- 用户名：3-50字符，唯一
- 邮箱：有效邮箱格式，唯一
- 密码：6-255字符（当前明文存储，建议加密）
- 默认角色：user
- 默认状态：active

---

#### UC-002: 用户登录
**用例名称**：用户登录  
**参与者**：访客、注册用户、管理员  
**前置条件**：用户已注册账号  
**后置条件**：用户登录成功，获得访问权限  

**主要流程**：
1. 用户访问登录页面
2. 系统显示登录表单（含粒子背景特效）
3. 用户输入用户名和密码
4. 系统验证凭证
5. 系统检查用户状态（active/inactive）
6. 系统生成Mock Token
7. 系统保存Token、用户名、角色到localStorage
8. 系统根据角色跳转（user→主页，admin→管理后台）

**异常流程**：
- 4a. 用户名或密码错误 → 显示"用户名或密码错误"，返回步骤3
- 5a. 用户状态为inactive → 显示"账号已被禁用"，返回步骤3

**业务规则**：
- Token格式：`mock-jwt-token-{username}-{user_id}`
- Token存储：localStorage
- 会话管理：基于localStorage，无过期时间
- 角色验证：登录后根据role字段判断权限

---

#### UC-003: 退出登录
**用例名称**：退出登录  
**参与者**：注册用户、管理员  
**前置条件**：用户已登录  
**后置条件**：清除会话，返回登录页面  

**主要流程**：
1. 用户点击"退出登录"按钮
2. 系统清除localStorage中的所有数据
3. 系统跳转到登录页面

**业务规则**：
- 清除数据：token, username, role, isLoggedIn
- 无需后端API调用
- 立即生效

---

### 图书浏览用例 (Book Browsing Use Cases)

#### UC-004: 浏览图书列表
**用例名称**：浏览图书列表  
**参与者**：访客、注册用户  
**前置条件**：访问主页  
**后置条件**：显示图书卡片列表  

**主要流程**：
1. 用户访问主页
2. 系统初始化粒子背景特效
3. 系统播放"欢迎来到科技书城"动画（首次访问）
4. 系统调用 `GET /api/books` 获取图书列表
5. 系统渲染图书卡片（瀑布流布局）
6. 系统显示图书信息（标题、作者、价格、评分、库存）
7. 用户可以悬停查看卡片动画效果

**业务规则**：
- 布局：CSS Column瀑布流，4列
- 封面：纯黑色背景
- 主题色：翠绿色系
- 排序：默认按创建时间降序
- 分页：暂无分页，一次性加载所有图书

**特效说明**：
- 粒子背景：Canvas绘制，60fps动画
- 鼠标交互：150px影响范围，粒子排斥+放大
- 卡片悬停：transform scale(1.05)，阴影增强

---

#### UC-005: 搜索图书
**用例名称**：搜索图书  
**参与者**：访客、注册用户  
**前置条件**：在主页  
**后置条件**：显示搜索结果  

**主要流程**：
1. 用户在搜索框输入关键词
2. 系统实时过滤图书列表
3. 系统匹配标题、作者、描述
4. 系统更新显示结果
5. 系统显示匹配数量

**业务规则**：
- 搜索范围：标题、作者、描述
- 匹配方式：模糊匹配，不区分大小写
- 实时搜索：输入即搜索
- 空搜索：显示所有图书

---

#### UC-006: 按分类筛选
**用例名称**：按分类筛选图书  
**参与者**：访客、注册用户  
**前置条件**：在主页  
**后置条件**：显示指定分类的图书  

**主要流程**：
1. 用户点击分类标签
2. 系统过滤对应分类的图书
3. 系统更新显示结果
4. 用户可以点击"全部"取消筛选

**业务规则**：
- 分类来源：categories表
- 默认分类：技术、文学、历史、科学、艺术等
- 单选模式：一次只能选择一个分类
- 全部分类：显示所有图书

---

#### UC-007: 查看图书详情
**用例名称**：查看图书详情  
**参与者**：访客、注册用户  
**前置条件**：在图书列表页  
**后置条件**：显示图书详细信息  

**主要流程**：
1. 用户点击图书卡片
2. 系统跳转到图书详情页
3. 系统显示图书完整信息
4. 系统显示评分和评论
5. 系统显示库存状态
6. 系统显示"加入购物车"按钮（登录用户）

**显示信息**：
- 基本信息：标题、作者、分类、价格
- 库存信息：库存数量、库存状态
- 评分信息：平均评分、评分人数
- 详细描述：图书简介
- 评论列表：用户评论和评分

**业务规则**：
- 库存状态：
  - stock > 20：充足
  - 10 < stock ≤ 20：紧张
  - stock ≤ 10：不足
  - stock = 0：缺货
- 评分显示：星级（1-5星）
- 评论排序：按时间降序

---

### 购物车用例 (Shopping Cart Use Cases)

#### UC-009: 添加到购物车
**用例名称**：添加商品到购物车  
**参与者**：注册用户  
**前置条件**：用户已登录  
**后置条件**：商品添加到购物车  

**主要流程**：
1. 用户在图书详情页点击"加入购物车"
2. 系统检查用户登录状态
3. 系统检查图书库存
4. 系统添加商品到购物车（默认数量1）
5. 系统更新购物车状态
6. 系统显示成功提示（Emoji特效）
7. 系统更新购物车图标数量

**异常流程**：
- 2a. 用户未登录 → 跳转到登录页面
- 3a. 库存不足 → 显示"库存不足"提示

**业务规则**：
- 默认数量：1
- 最大数量：不超过库存
- 重复添加：数量累加
- 存储方式：localStorage + 后端API

---

#### UC-010: 查看购物车
**用例名称**：查看购物车  
**参与者**：注册用户  
**前置条件**：用户已登录  
**后置条件**：显示购物车列表  

**主要流程**：
1. 用户点击购物车图标
2. 系统跳转到购物车页面
3. 系统显示购物车商品列表
4. 系统计算总价
5. 系统显示操作按钮（修改数量、删除、结算）

**显示信息**：
- 商品信息：标题、作者、价格、数量
- 小计：单价 × 数量
- 总计：所有商品小计之和
- 操作按钮：+、-、删除、清空、结算

**业务规则**：
- 空购物车：显示"购物车为空"提示
- 价格计算：实时更新
- 库存检查：结算时验证

---

#### UC-011: 修改商品数量
**用例名称**：修改购物车商品数量  
**参与者**：注册用户  
**前置条件**：购物车中有商品  
**后置条件**：更新商品数量和总价  

**主要流程**：
1. 用户点击"+"或"-"按钮
2. 系统检查库存限制
3. 系统更新商品数量
4. 系统重新计算总价
5. 系统更新显示

**异常流程**：
- 2a. 数量超过库存 → 显示"库存不足"，保持原数量
- 2b. 数量减到0 → 提示是否删除商品

**业务规则**：
- 最小数量：1
- 最大数量：库存数量
- 数量为0：自动删除商品

---

#### UC-012: 删除购物车商品
**用例名称**：删除购物车商品  
**参与者**：注册用户  
**前置条件**：购物车中有商品  
**后置条件**：商品从购物车移除  

**主要流程**：
1. 用户点击"删除"按钮
2. 系统显示确认对话框
3. 用户确认删除
4. 系统移除商品
5. 系统重新计算总价
6. 系统更新显示

**业务规则**：
- 需要确认：防止误删
- 立即生效：无需刷新页面
- 可恢复：需重新添加

---

#### UC-014: 提交订单
**用例名称**：提交订单  
**参与者**：注册用户  
**前置条件**：购物车中有商品  
**后置条件**：创建订单，清空购物车  

**主要流程**：
1. 用户点击"结算"按钮
2. 系统验证购物车不为空
3. 系统验证所有商品库存
4. 系统创建订单记录
5. 系统更新图书库存
6. 系统创建销售记录
7. 系统清空购物车
8. 系统显示订单成功提示
9. 系统跳转到订单详情页

**异常流程**：
- 2a. 购物车为空 → 显示"购物车为空"
- 3a. 库存不足 → 显示具体商品库存不足，返回购物车

**业务规则**：
- 订单状态：pending（待处理）
- 库存扣减：立即扣减
- 事务处理：订单创建和库存更新在同一事务
- 订单号：自动生成（自增ID）

---

### 订单用例 (Order Use Cases)

#### UC-015: 查看订单列表
**用例名称**：查看订单列表  
**参与者**：注册用户  
**前置条件**：用户已登录  
**后置条件**：显示用户的所有订单  

**主要流程**：
1. 用户点击"我的订单"
2. 系统调用 `GET /api/orders` 获取订单列表
3. 系统显示订单表格
4. 系统显示订单状态、总金额、创建时间
5. 用户可以点击查看详情或取消订单

**显示信息**：
- 订单号
- 订单状态（pending/completed/cancelled）
- 总金额
- 创建时间
- 操作按钮（查看详情、取消订单）

**业务规则**：
- 排序：按创建时间降序
- 筛选：可按状态筛选
- 分页：暂无分页

---

#### UC-016: 查看订单详情
**用例名称**：查看订单详情  
**参与者**：注册用户  
**前置条件**：在订单列表页  
**后置条件**：显示订单详细信息  

**主要流程**：
1. 用户点击"查看详情"
2. 系统调用 `GET /api/orders/:id` 获取订单详情
3. 系统显示订单基本信息
4. 系统显示订单商品列表
5. 系统显示订单状态和时间

**显示信息**：
- 订单基本信息：订单号、状态、总金额、创建时间
- 商品列表：标题、作者、单价、数量、小计
- 订单总计：商品总价

**业务规则**：
- 只能查看自己的订单
- 显示完整商品信息
- 显示订单状态历史

---

#### UC-017: 取消订单
**用例名称**：取消订单  
**参与者**：注册用户  
**前置条件**：订单状态为pending  
**后置条件**：订单状态更新为cancelled，恢复库存  

**主要流程**：
1. 用户点击"取消订单"
2. 系统检查订单状态
3. 系统显示确认对话框
4. 用户确认取消
5. 系统更新订单状态为cancelled
6. 系统恢复图书库存
7. 系统显示取消成功提示

**异常流程**：
- 2a. 订单已完成 → 显示"订单已完成，无法取消"
- 2b. 订单已取消 → 显示"订单已取消"

**业务规则**：
- 可取消状态：pending
- 不可取消状态：completed, cancelled
- 库存恢复：立即恢复
- 事务处理：状态更新和库存恢复在同一事务

---

### 管理用例 (Management Use Cases)

#### UC-021: 管理图书
**用例名称**：管理图书（增删改查）  
**参与者**：管理员  
**前置条件**：管理员已登录管理后台  
**后置条件**：图书数据更新  

**主要流程**：

**查看图书列表**：
1. 管理员进入图书管理界面
2. 系统显示图书表格
3. 系统显示图书统计信息

**添加图书**：
1. 管理员点击"添加图书"
2. 系统显示图书表单
3. 管理员填写图书信息
4. 系统验证数据
5. 系统查找最小可用ID
6. 系统插入图书记录
7. 系统记录操作日志
8. 系统刷新图书列表

**编辑图书**：
1. 管理员点击"编辑"
2. 系统显示图书表单（预填数据）
3. 管理员修改图书信息
4. 系统验证数据
5. 系统更新图书记录
6. 系统记录操作日志
7. 系统刷新图书列表

**删除图书**：
1. 管理员点击"删除"
2. 系统检查是否有关联订单
3. 系统显示确认对话框
4. 管理员确认删除
5. 系统删除图书记录
6. 系统记录操作日志
7. 系统刷新图书列表

**业务规则**：
- ID分配：填充最小可用ID（如1,2,4,5 → 新书ID=3）
- 删除限制：有订单的图书不可删除
- 操作日志：记录所有增删改操作
- 数据验证：标题、作者、价格、库存必填

---

#### UC-022: 管理用户
**用例名称**：管理用户（增删改查）  
**参与者**：管理员  
**前置条件**：管理员已登录管理后台  
**后置条件**：用户数据更新  

**主要流程**：

**查看用户列表**：
1. 管理员进入用户管理界面
2. 系统显示用户表格
3. 系统显示用户统计信息

**添加用户**：
1. 管理员点击"添加用户"
2. 系统显示用户表单
3. 管理员填写用户信息
4. 系统验证数据
5. 系统检查用户名和邮箱重复
6. 系统插入用户记录
7. 系统记录操作日志
8. 系统刷新用户列表

**编辑用户**：
1. 管理员点击"编辑"
2. 系统显示用户表单（预填数据）
3. 管理员修改用户信息
4. 系统验证数据
5. 系统更新用户记录
6. 系统记录操作日志
7. 系统刷新用户列表

**删除用户**：
1. 管理员点击"删除"
2. 系统检查是否有关联订单
3. 系统显示确认对话框
4. 管理员确认删除
5. 系统删除用户记录
6. 系统重新索引用户ID（1,2,3...）
7. 系统记录操作日志
8. 系统刷新用户列表

**切换用户状态**：
1. 管理员点击"状态"按钮
2. 系统切换active/inactive
3. 系统更新用户状态
4. 系统记录操作日志
5. 系统刷新用户列表

**业务规则**：
- ID重新索引：删除用户后，所有用户ID重新排序（1,2,3...）
- 删除限制：有订单的用户不可删除
- 状态管理：inactive用户无法登录
- 操作日志：记录所有增删改操作
- 数据验证：用户名、邮箱、密码必填

---

#### UC-023: 管理订单
**用例名称**：管理订单（查看、更新状态、取消）  
**参与者**：管理员  
**前置条件**：管理员已登录管理后台  
**后置条件**：订单数据更新  

**主要流程**：

**查看订单列表**：
1. 管理员进入订单管理界面
2. 系统显示订单表格
3. 系统显示订单统计信息

**查看订单详情**：
1. 管理员点击"查看详情"
2. 系统显示订单基本信息
3. 系统显示订单商品列表
4. 系统显示用户信息

**更新订单状态**：
1. 管理员选择订单
2. 管理员选择新状态
3. 系统更新订单状态
4. 系统记录操作日志
5. 系统刷新订单列表

**取消订单**：
1. 管理员点击"取消订单"
2. 系统显示确认对话框
3. 管理员确认取消
4. 系统更新订单状态为cancelled
5. 系统恢复图书库存
6. 系统记录操作日志
7. 系统刷新订单列表

**业务规则**：
- 状态流转：pending → completed 或 pending → cancelled
- 库存恢复：取消订单时恢复库存
- 操作日志：记录所有状态变更
- 权限控制：只有管理员可以操作

---

#### UC-024: 查看销售统计
**用例名称**：查看销售统计  
**参与者**：管理员  
**前置条件**：管理员已登录管理后台  
**后置条件**：显示销售统计数据  

**主要流程**：

**销售总览**：
1. 管理员进入销售统计界面
2. 系统计算总收入
3. 系统计算订单数量
4. 系统显示统计图表

**热门图书**：
1. 管理员点击"热门图书"
2. 系统查询v_popular_books视图
3. 系统显示评分≥4.5的图书
4. 系统按评分降序排列

**用户统计**：
1. 管理员点击"用户统计"
2. 系统统计活跃用户数量
3. 系统统计总用户数量
4. 系统显示用户增长趋势

**业务规则**：
- 数据来源：sales_records表
- 热门图书：评分≥4.5，取前10名
- 用户统计：基于v_active_users视图
- 实时更新：每次访问重新计算

---

## 📈 用例优先级

### 高优先级（核心功能）
1. **UC-002: 用户登录** - 系统入口
2. **UC-004: 浏览图书列表** - 核心功能
3. **UC-009: 添加到购物车** - 购物流程
4. **UC-014: 提交订单** - 交易核心
5. **UC-021: 管理图书** - 管理核心

### 中优先级（重要功能）
1. **UC-001: 用户注册** - 用户增长
2. **UC-007: 查看图书详情** - 信息展示
3. **UC-010: 查看购物车** - 购物流程
4. **UC-015: 查看订单列表** - 订单管理
5. **UC-022: 管理用户** - 用户管理

### 低优先级（辅助功能）
1. **UC-005: 搜索图书** - 便捷功能
2. **UC-006: 按分类筛选** - 便捷功能
3. **UC-017: 取消订单** - 辅助功能
4. **UC-024: 查看销售统计** - 数据分析

---

## 🔄 用例关系

### 包含关系 (Include)
- **UC-009 (添加到购物车)** 包含 **UC-007 (查看图书详情)**
- **UC-014 (提交订单)** 包含 **UC-010 (查看购物车)**
- **UC-018 (发表评论)** 包含 **UC-007 (查看图书详情)**
- **UC-020 (评分图书)** 包含 **UC-007 (查看图书详情)**

### 扩展关系 (Extend)
- **UC-016 (查看订单详情)** 扩展 **UC-015 (查看订单列表)**
- **UC-017 (取消订单)** 扩展 **UC-015 (查看订单列表)**

### 泛化关系 (Generalization)
- **注册用户** 继承 **访客** 的所有权限
- **管理员** 拥有独立的管理权限

---

## 📚 相关文档

- [系统架构文档](./SYSTEM_ARCHITECTURE.md) - 完整的系统架构设计
- [背景特效总结](./BACKGROUND_AND_EFFECTS_SUMMARY.md)
- [UI重新设计总结](./UI_REDESIGN_SUMMARY.md)

---

**文档版本**：v1.0  
**最后更新**：2024年  
**维护者**：开发团队  

喵~用例分析文档完成啦！🐾✨

